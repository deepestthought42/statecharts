(in-package #:statecharts)

;;; macros and their helper that make up the statecharts DSL


(defun %t (initial-name event final-name if)
  (labels ((format-name (name)
	     (cond
	       ((stringp name) name)
	       ((listp name) (format nil "狺藓湖钺礤┅ㄥ蝌矧⒃栝箬秕熹栳痧孱┅┅磲脲轭篝犷沐趄犷箝糸镱侯犴ㄦ矧磲铋幄ㄦ矧磲舡钺礤轭轸獒飙钺礤ㄦ矧磲舡钺礤骈钺飙钺礤┅哄鲥铘弼孱洪铋糸犰篝狒轭轸獒飙钺礤烘轭犰篝狒骈钺飙钺礤虹踽蜾ㄩ殒殒ㄣ镱篝犷綮舂┅┅ㄤ彐躅ン钺礤溴筱蜷痿轱孱趄屮轸磲脲轭篝犷沐篝狒侯犴钺礤轰弩泸轲糸镱溴筱蜷痿轱猴瞽孱趄孱趄猴瞽屮轸屮轸┅ㄤ彐躅ャ桢汶溴骟翎翦汨狎舡狎珲礤铘钺礤溴筱蜷痿轱溴骈铋糸镱螬ㄤ邈灬蝈ㄩ珙矧溴骈铋糸镱螬ㄣ镱è铒簌礅镬钺礤┅ㄥ蝌矧ч铞犰殇汨狎舡簌铘狲喉弩筢珏⑽犴铄邃麸忮簌礅镬猴骀孱溟铉泔溴钺礤┅è铒篝蜷铉溴筱蜷痿轱瞟ㄥ蝌矧ч铞犰殇汨狎舡簌铘狲喉弩筢珏⒛弩泸轲糸镱铄邃麸忮篝蜷铉猴骀孱溟铉泔溴溴筱蜷痿轱瞟┅换换桢祓弪磲泸矬ㄤ彐磲泸ン躔弪篝狒豉疱钺礤篝狒瀛箦戾泗矧溴驷蹯舡篝狒溴筱蜷痿轱孱趄屮轸篚猸篝狒弩ㄣ狍豉疱ㄣ祯篝弪啜戾è篚猸篝狒弩扉篝荔踱篝狒弩┅ㄩ铒ㄦ轭溴驷蹯舡篝狒篚猸篝狒弩弘妁＇钺礤呼弩＇篝蜷铉僵ㄥ蝌矧с秕熹铘骈钿溴驷蹯舡篝狒轰彐狨祠篝狒溴驷蹯舡篝狒恒祯篝弪钺礤┅磲脲轭篝犷沐с祯篝弪侯犴钺礤轰弩泸轲糸镱溴筱蜷痿轱猴瞽孱趄孱趄猴瞽屮轸屮轸后屐邈麸颦豉疱К篝狒瀛箦戾泗矧轰彐狨祠篝狒溴驷蹯舡篝狒哄戾礤铘篚猸篝狒弩┅矧翳镧镱犰啜磲脲轭篝犷沐э螋栾顼钺侯犴钺礤轰弩泸轲糸镱溴筱蜷痿轱猴瞽孱趄孱趄猴瞽屮轸屮轸哄戾礤铘扉篝荔踱篝狒弩┅┅换篝狒邈栳螋溴骈铋糸镱灬铉踽珏ㄤ彐磲泸ㄥ鲥铘轭轸獒骈钺脲麒孱轭篝狒濠⑶轹孱弼孱鏖翳钺礤胖盼袁泔铙趄蹉犷镡赍泗镦豉疱砸廖由陨衔骝镯轭轸獒篝狒鏖翳钺礤晌稍闪麸骈钺篝狒鏖翳钺礤粕瘟坍涉善轶铒瞽铋飕轸轶狍篚礤麸忮骢钽糸镱镦镱疳蜥礤翦颥翳篝狒邈栳螋盼稚蚁瓮盼犷翳趄犷箝糸镱鏖祆镱禊痱镢邋殒善蝈趱蝾趄蹂浇砸廖由陨衔啜篝狒邈栳螋蠛亥轭轸獒弼孱骈钺麒孱轭篝狒濠ㄤ彐磲泸钺礤é脲ㄤ弩泸轲糸镱孱趄屮轸怙澌篚猸篝狒弩⒁弭躜铙犷镡赍泗镦豉疱弦匀锨衔撂鏖翳轸篚猸篝狒弩忮轭徙糸鲥狒翳筢礤糸礤楫瀹祜玳汜泔铌躅泗轱镦翳篚猸篝狒弩熄帘廖帘敛廖鏖翳翳钺礤瘟团翳狒鏖祆栳鲥诱颅釉猎庞狍轸篚猸篝狒弩澡轭轸獒篝狒鏖祆忮汨镲箦怡釉猎怒优膛迷弦犷呐屏仗原釉猎女轴扉簌礅镬骘釉猎怒优膛迷弦狎ㄦ矧溴驷蹯舂犷ㄦ矧栝篝矧┊呐用疑性上轶犷镳糸镱犰屮痨犷狒轱骘翳矧翳镧镱犰沆躞翦虍涉玳鲥翳骢钽糸镱盼砸鏖祆忮汜祆邃躔镱篝狒瀛汨犷珏轭麸翳篝狒瘟团犷咆稍鏖祆忮汜祆邃躔镱篝狒瀛汨犷珏秕镦翳篝狒瘟团咆稍犷盼砸骢钽糸镱镦镱鲠蜷徕戾犷鏖祆忮汜祆邃鏖翳翳盼稚蚁瓮盼狍翳彘疳蜥礤翦虍骄弦匀锨衔撂啜ン躔弪篝狒矧翳镧镱犰钺礤铋铋溴筱蜷痿轱孱趄屮轸篚猸篝狒弩┅ㄤ彐磲泸钺礤篝狒瀛箦戾泗矧溴驷蹯舡篝狒脲ㄤ弩泸轲糸镱孱趄屮轸怙澌篚猸篝狒弩⒁弭躜铙犷镡赍泗镦豉疱锰沼耘鏖翳镱禊镱篚猸篝狒忮轭徙糸鲥狒犰糸礤蟋楫瀹祜玳汜泔铌躅泗轱镦翳篚猸篝狒弩熄帘廖帘敛廖鏖翳翳钺礤瘟团翳狒鏖祆栳鲥诱颅釉猎庞狍轸篚猸篝狒弩澡轭轸獒篝狒鏖祆忮汨镲箦怡釉猎怒优膛迷弦犷呐屏仗原釉猎女轴扉簌礅镬骘釉猎怒优膛迷弦狎ㄦ矧溴驷蹯舂犷ㄦ矧栝篝矧┊呐用疑性上轶犷镳糸镱犰屮痨犷狒轱骘翳矧翳镧镱犰沆躞翦虍涉玳鲥翳骢钽糸镱盼砸鏖祆忮汜祆邃躔镱篝狒瀛汨犷珏轭麸翳篝狒瘟团犷咆稍鏖祆忮汜祆邃躔镱篝狒瀛汨犷珏秕镦翳篝狒瘟团咆稍犷盼砸骢钽糸镱镦镱鲠蜷徕戾犷鏖祆忮汜祆邃鏖翳翳盼稚蚁瓮盼狍翳彘疳蜥礤翦虍骄锰沼耘尧啜ン躔弪篝狒沆躞翦钺礤篝狒瀛箦戾泗矧溴驷蹯舡篝狒溴筱蜷痿轱孱趄屮轸篚猸篝狒弩┅ㄤ彐磲泸钺礤脲ㄤ弩泸轲糸镱孱趄屮轸⒁弭躜铙犷镡赍泗镦豉疱釉猎鏖翳翳钺礤瘟团呐用疑性上轶犷镳糸镱犰屮痨犷狒轱骘翳矧翳镧镱犰沆躞翦虍涉玳鲥翳骢钽糸镱盼砸鏖祆忮汜祆邃躔镱篝狒瀛汨犷珏轭麸翳篝狒瘟团犷咆稍鏖祆忮汜祆邃躔镱篝狒瀛汨犷珏秕镦翳篝狒瘟团咆稍犷盼砸骢钽糸镱镦镱鲠蜷徕戾犷鏖祆忮汜祆邃鏖翳翳盼稚蚁瓮盼狍翳彘疳蜥礤翦虍骄釉猎泞啜篝狒邈栳螋蠛亥钺礤溴筱蜷痿轱孱趄屮轸┅ㄤ彐磲泸猴é蝈篝珲狎潴┅ㄤ彐磲泸横钿é蝈篝珲狎潴┅ㄤ彐磲泸徙è镳糸镱犰ㄥ铞轵镱礤铘簌礅镬у铞┅怙澌泔溴啜磲脲轭篝犷沐筱横泗轱恒镤К泔溴烘躅＇灬礅溽ì孱鲩蝻铐孱舡簌礅镬ㄤ邈灬蝈ㄩ珙矧徕戾孱鲩蝻铐孱舡簌礅镬┅楞镤濠┅ㄤ彐躅ャ蝈狒瀛篝狒瀛汨狎钺礤蝻雉溴筱蜷痿轱瞟戾舄è篝狒弩ㄣ镯瘐翦篚怏翎翦蝻雉┅ㄦ箜篝狒弩ㄣ蝈狒瀛骟憝篝狒弩篝狒弩┅趄犷箝糸镱ㄣ镯瘐翦趄犷箝糸镱蝻雉Ж蝻雉┅ㄥ鲥铘蝈盹鲥漉痨殂狒弩磲疸狎＇弼孱舡钺礤趄犷箝糸镱螬┅ㄤ彐狨祠篝狒ㄦ轵篝蝈盹鲥殒铒＇轶溴驷蹯舡篝狒篝狒弩┅┅箦舡趄犷箝糸镱蟓骘颦骟憝篝狒弩篝狒弩骟憝篝狒弩趄犷箝糸镱螬磲脲轭篝犷沐篝狒邈栳螋蠛后翎翦汨狎侯犴篝蜷铉钺礤轰弩泸轲糸镱溴筱蜷痿轱候镲蝻雉后翎翦篝狒弩烘箜篝狒弩骟憝篝狒弩呼蜥铙轸轱铙趄犷箝糸镱哄鲥铘弼孱趔轰彐狨祠篝狒溴驷蹯舡篝狒濠┅ㄤ彐磲泸溴骟翎翦汨狎è钺礤脲ㄤ弩泸轲糸镱┅怙澌溴骈铋糸镱螬ē汨邈氕溴骟翎翦汨狎舡狎珲礤铘钺礤溴筱蜷痿轱溴骈铋糸镱螬ㄣ戾狎殇啜溴骛狎犴弭弪钺礤ē泸遽翦篝狒瀛汨狎К钺礤痱镧冷彐轭轸轱铙溴筱蜷痿轱瞟┅换ㄩ瞽蝈徜翎忪烘狎瀛聃狍轳躏翦换ㄤ彐躅疳蝮扉篝换磲翥┅换ㄤ彐躅潴é蝈篝篝狒邈栳螋溴筱蜷痿轱瞟换⑿狎箦篝狒邈栳螋挠